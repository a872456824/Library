# 第二天（上）

## 红黑树——初中生必知必会系列

- 工程实践中，使用的大多数红黑树

## 一、平衡条件（4跟5是关键，1-3基本是废话）

1. 节点非黑既红
2. 根节点是黑色
3. 叶子（NIL）结点是黑色（`虚拟叶子节点`，基本就是废话，相当于`NULL`）
4. `红色节点`下面接`两个黑色节点`
5. 从根节点到叶子结点路径上，`黑色`节点`数量相同`（不考虑NIL节点，只考虑实际节点）

### 平衡条件的认识

`第4条和第5条条件`，注定了，红黑树中`最长路径`是`最短路径`的`长度的 2 倍`。

本质上，红黑树也是通过`树高`来控制平衡的，因为`最长路径最多是最短路劲的2倍`。

红黑树比 AVL 树`树高控制`条件要更`松散`，红黑树在发生`节点插入和删除`以后，发生`调整的概率`，比 AVL 树要更`小`。

## 二、学习诀窍（插入调整与删除调整分开）

1. 理解红黑树的插入调整，要站在==祖父节点==向下进行调整
   1. 向下查看`两层`，看`爸爸跟儿子`是否发生冲突
   2. 如果`站在父节点的位置`，发现`父节点与儿子发生冲突`，这个时候`不调整`
2. 理解红黑树的删除调整，要站在==父节点==向下进行调整
   1. 删除时，只需`向下看一层`，看两个孩子是否需要调整
3. 插入调整，主要就是为了解决双红情况
4. 新插入的节点`一定是红色`，插入`黑色节点`一定会产生冲突，`违反条件5`，插入`红色节点`，`不一定`产生冲突（即黑色节点`一定会`调整，红色节点`不一定会`调整）
5. 把每一种情况，想象成一棵大的红黑树中的局部子树
6. 局部调整的时候，为了`不影响全局`，调整`前后`的`路径上黑色节点数量相同`



## 三、插入策略

1. `叔叔节点为红色`的时候，修改三元组小帽子，改成`红黑黑`
2. 叔叔节点为`黑色`的时候，参考 `AVL 树的失衡`情况，分成 $LL,LR,RL,RR$, 先参考 AVL 树的`旋转调整策略`，然后再修改三元组的颜色，有两种调整策略：`红色上浮，红色下沉`。 
3. 两大类情况，包含 8 种小情况（4+4）



## 四、代码演示

1. 插入调整，发正在递归的回溯阶段
2. 插入调整代码中，使用 goto 语句，8行代码，变成了4行
3. 处理根节点一定是黑色，通过代码封装，$insert->\_\_insert$

